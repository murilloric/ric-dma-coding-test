var MASTERAPP = angular.module('masterapp',['ionic', 'ngCookies'])

MASTERAPP.config(['$stateProvider', '$ionicConfigProvider', '$urlRouterProvider', function($stateProvider, $ionicConfigProvider, $urlRouterProvider) {
  //$ionicConfigProvider.views.transition(true);
  $ionicConfigProvider.templates.maxPrefetch(0);
  $ionicConfigProvider.views.maxCache(0);
  $ionicConfigProvider.scrolling.jsScrolling(true)


  $urlRouterProvider.otherwise('/home')

  $stateProvider.state('home', {
    url: '/home',
    templateUrl: '/clientlibs/templates/home.html',
    controller:'homeCtrl'
  })

}]);
MASTERAPP.factory('ricsAPI', ['$http', '$state', '$cookies', '$ionicPopup', function($http, $state, $cookies, $ionicPopup){
	movie_data = {
    "items": [{
        "image": "img/movie-thumb_1c02f92da5b7c_web__027649.jpg",
        "title": "Toy Story",
        "slug": "toy-story",
        "date": "1995-11-22",
        "rating": "g",
        "run_time": 4862
    }, {
        "image": "img/movie-thumb_bf638c79f8318_web.jpg",
        "title": "a bug's life",
        "slug": "a-bugs-life",
        "date": "1998-11-20",
        "rating": "G",
        "run_time": 5691
    }, {
        "image": "img/movie-thumb_e01218fb3f3bd_web__396403.jpg",
        "title": "Toy Story 2",
        "slug": "toy-story-2",
        "date": "1999-11-19",
        "rating": "G",
        "run_time": 5542
    }, {
        "image": "img/movie-thumb_77bd43c428c40_web.jpg",
        "title": "Monsters, Inc.",
        "slug": "monsters-inc",
        "date": "2001-11-02",
        "rating": "g",
        "run_time": 5527
    }, {
        "image": "img/movie-thumb_217853_web.jpg",
        "title": "Finding Nemo",
        "slug": "finding-nemo",
        "date": "2003-05-30",
        "rating": "G",
        "run_time": 6053
    }, {
        "image": "img/movie-thumb_146049_web.jpg",
        "title": "The Incredibles",
        "slug": "incredibles",
        "date": "2004-11-05",
        "rating": "PG",
        "run_time": 6918
    }, {
        "image": "img/movie-thumb_311969_web.jpg",
        "title": "Cars",
        "slug": "cars",
        "date": "2006-06-09",
        "rating": "g",
        "run_time": 7001
    }, {
        "image": "img/movie-thumb_116969_web.jpg",
        "title": "Ratatouille",
        "slug": "ratatouille",
        "date": "2007-06-29",
        "rating": "G",
        "run_time": 6662
    }, {
        "image": "img/movie-thumb_16de930a41d84_web.jpg",
        "title": "WALL-E",
        "slug": "wall-e",
        "date": "2008-06-27",
        "rating": "G",
        "run_time": 5887
    }, {
        "image": "img/movie-thumb_0bb442332b6a2_web.jpg",
        "title": "Up",
        "slug": "up",
        "date": "2009-05-29",
        "rating": "pg",
        "run_time": 5764
    }, {
        "image": "img/movie-thumb_789c03c3930d6_web__234823.jpg",
        "title": "Toy Story 3",
        "slug": "toy-story-3",
        "date": "2010-06-18",
        "rating": "G",
        "run_time": 6148
    }, {
        "image": "img/movie-thumb_116641_web.jpg",
        "title": "Cars 2",
        "slug": "cars-2",
        "date": "2011-06-24",
        "rating": "g",
        "run_time": 6373
    }, {
        "image": "img/movie-thumb_56afa2448b906_web.jpg",
        "title": "Brave",
        "slug": "brave",
        "date": "2012-06-22",
        "rating": "PG",
        "run_time": 5615
    }, {
        "image": "img/movie-thumb_ad70e2578b2ca_web.jpg",
        "title": "Monsters University",
        "slug": "monsters-university",
        "date": "2013-06-21",
        "rating": "G",
        "run_time": 6230
    }]
}





	var service = {}

	service.searchForMovies = function(callBack){

		return callBack(movie_data)

	}

	return service

}]);
MASTERAPP.controller('homeCtrl', ['$scope', 'ricsAPI', function ($scope, ricsAPI) {
	///sort and order movies
	$scope.sort_property = 'title'
	$scope.sort_order = false

	//load movie data
	ricsAPI.searchForMovies(function(resp){
		$scope.movie_data = resp;

	});

}]);

MASTERAPP.filter('runTime', function(){

	return function(input){
		var out = '';
		var hours = Math.floor(input / (60 * 60));
		var divs_mins = input % (60 * 60);
		var mins = Math.floor(divs_mins / 60);
		var hr_text = (hours > 1)?'hrs ':'hr ';
		out += hours + hr_text + mins + 'mins';
		return out
	}



})